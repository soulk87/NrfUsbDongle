# Key RF Protocol

* 키/트랙볼 모듈과 동글이 통신하는 규격을 정의함

## Protocol 요구사항

* 키/트랙볼 모듈은 눌린 키의 메트릭스 값과 트랙볼의 움직임 값만 TX함.
* 왼쪽 오른쪽에 따른 ID가 표시되어야 함.
* 기본적인 Checksum 기능이 있어야 됨.
* Protocol의 길이는 가변적이 될 수 있어야 함.
* Protocol을 보낼 때 키 정보인지 트랙볼 정보인지 알 수 있어야 함.
* **성능**: 최대 1000Hz 폴링 레이트 지원.
* **전력 관리**: 배터리 절약을 위한 슬립 모드 지원.
* **신뢰성**: 패킷 손실 시 재전송 메커니즘.
* **호환성**: 향후 확장 가능한 프로토콜 버전 관리.

### Key 정보

* **키 매트릭스 데이터**: 열 길이(byte) (행 길이는 8로 고정)
* **키 배열**: Press(1)/Release(0) 상태 구분

### 트랙볼 정보

* **움직임 데이터**: X, Y 축 상대 좌표값 (int16)

## Key RF Protocol Payload

### 공통 헤더 구조

| Start Byte | Device ID | Version | Packet Type | Length | Payload | Checksum |
|:----------:|:---------:|:-------:|:-----------:|:------:|:-------:|:--------:|
|     1B     |    1B     |   1B    |     1B      |   1B   |  0-32B  |   1B     |

**필드 설명:**

* **Start Byte**: 패킷 시작 마커 (0xAA)
* **Device ID**: 좌측(0x01)/우측(0x02) 모듈 구분
* **Version**: 프로토콜 버전 정보
* **Packet Type**: 데이터 타입 구분 (키/트랙볼/상태)
* **Length**: 페이로드 길이 (가변 길이 지원)
* **Payload**: 실제 데이터 (최대 32바이트)
* **Checksum**: 데이터 무결성 검증 (XOR 체크섬)

### 패킷 타입

* `0x01`: 키 입력 데이터
* `0x02`: 트랙볼 데이터
* `0x03`: 시스템 상태
* `0x04`: 배터리 정보
* `0xF0-0xFF`: 제어 명령

## Key RF Protocol Data

### 키 입력 패킷 구조

| Column Count | Key States (8bit × N) |
|:------------:|:---------------------:|
|     1B       |      N Bytes          |

* **Column Count**: 키 매트릭스의 열 개수 (1바이트, N)
* **Key States**: 각 열마다 8비트(1바이트)로 행의 Press(1)/Release(0) 상태를 표현  
    (예: 3열이면 Key States는 3바이트, 각 비트가 해당 행의 상태)

**예시:**  

* 3열 매트릭스의 경우  
  * Column Count: `0x03`
  * Key States: `[0b00000001, 0b00010000, 0b00000000]` (총 3바이트, 각 비트가 행 상태)

### 트랙볼 패킷 구조

| X 이동 (int16) | Y 이동 (int16) |
|:--------------:|:--------------:|
|      2B        |      2B        |

* **X 이동**: 트랙볼의 X축 상대 이동값 (2바이트, little-endian)
* **Y 이동**: 트랙볼의 Y축 상대 이동값 (2바이트, little-endian)

**예시:**  

* X 이동: `0x01 0x00` (1만큼 오른쪽 이동)
* Y 이동: `0xFF 0xFF` (-1만큼 아래로 이동)

### 에러 처리 및 재전송

* ACK/NACK 메커니즘
* 타임아웃 처리 (50ms)
* 최대 3회 재전송
